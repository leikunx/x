<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8" />
        <title>图片缩小工具</title>
        <style type="text/css">
            body {
                position: relative;
                font-size: 24px;
            }
            #root {
                position: absolute;
                top: 50px;
                width: 1100px;
                left: 0;
                right: 0;
                margin: auto;
            }
            #upload_form {
                margin-left: 60px;
            }
            #photo {
                box-sizing: border-box;
                padding: 24px;
                max-width: 100%;
            }
            #inputs, #now {
                display: flex;
                flex-direction: row;
                padding: 18px 30px;
                width: calc(100% - 60px);
                gap: 6px;
            }
            .in {
                width: 150px;
                font-size: 28px;
            }
            #text {
                margin-left: 12px;
            }
            a {
                margin-left: 30px;
                padding: 2px 16px;
                text-decoration: none;
                color: black;
                background-color: rgb(246, 248, 250);
                cursor: pointer;
                border-radius: 6px;
                border: solid 2px rgba(27, 31, 36, 0.15);
                text-align: center;
            }
        </style>
        <script src="https://code.jquery.com/jquery-3.3.1.min.js"></script>
    </head>
    <body>
        <div id="root">
            <form id="upload_form" enctype="multipart/form-data">
                <input type="file" id="image_file" />
            </form>
            <div id="now">
                <div>原宽度：</div>
                <input type="text" class="in" id="oldWidth" readonly />
                <div id="text">原高度：</div>
                <input type="text" class="in" id="oldHeight" readonly />
            </div>
            <div id="inputs">
                <div>新宽度：</div>
                <input type="text" class="in" id="newWidth" />
                <div id="text">新高度：</div>
                <input type="text" class="in" id="newHeight" />
                <a id="download">下载图片</a>
            </div>
            <img id="photo" />
        </div>
        <script type="text/javascript">
            $("#image_file").change(function () {
                var file = $(this)[0].files[0];
                $("img#photo").attr("src", URL.createObjectURL(file));
                function show() {
                    var image = document.getElementById("photo");
                    $("#oldWidth").val(image.naturalWidth);
                    $("#oldHeight").val(image.naturalHeight);
                }
                setTimeout(show, 100);
                setTimeout(show, 1000);
            });
            function getImageUrl(id, targetWidth, targetHeight) {
                var image = document.getElementById(id);
                var canvas = document.createElement("canvas");
                canvas.width = targetWidth;
                canvas.height = targetHeight;
                const ctx = canvas.getContext("2d");
                ctx.drawImage(image, 0, 0, image.naturalWidth, image.naturalHeight, 0, 0, targetWidth, targetHeight);
                return canvas.toDataURL("image/jpeg");
            }
            $("#download").click(function() {
                var link = document.createElement("a");
                link.download = "resized_photo.jpg";
                var width = parseInt($("#newWidth").val());
                var height = parseInt($("#newHeight").val());
                var url = getImageUrl("photo", width, height);
                link.href = url;
                link.click();
            });
        </script>
    </body>
</html>
